{% extends "base.html" %}

{% block title %}Channels - You Hoard{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Channels</h1>
    <p class="page-subtitle">Manage your subscribed channels and view statistics</p>
</div>

<!-- Search and Filters -->
<div class="card mb-6">
    <div class="card-body">
        <div class="channel-controls">
            <div class="search-group">
                <input type="text" id="search-input" placeholder="Search channels..." class="search-input">
                <button id="search-btn" class="btn btn-primary">Search</button>
            </div>
            
            <div class="filter-group">
                <select id="subscription-filter" class="filter-select">
                    <option value="">All Channels</option>
                    <option value="subscribed">Subscribed</option>
                    <option value="not-subscribed">Not Subscribed</option>
                </select>
                
                <button id="clear-filters" class="btn btn-secondary">Clear</button>
            </div>
        </div>
    </div>
</div>

<!-- Channels Grid -->
<div class="channels-grid" id="channels-grid">
    <div class="loading-placeholder">Loading channels...</div>
</div>

<!-- Pagination -->
<div class="pagination-wrapper" id="pagination-wrapper" style="display: none;">
    <div class="pagination-info">
        <span id="pagination-info-text"></span>
    </div>
    <div class="pagination-controls">
        <button id="prev-page" class="btn btn-secondary" disabled>Previous</button>
        <span id="page-numbers"></span>
        <button id="next-page" class="btn btn-secondary" disabled>Next</button>
    </div>
</div>

<!-- Channel Detail Modal -->
<div class="modal" id="channel-detail-modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="channel-detail-title">Channel Details</h3>
            <button class="modal-close" id="close-channel-detail">&times;</button>
        </div>
        <div class="modal-body">
            <div id="channel-detail-content">
                <!-- Channel details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Subscribe Modal -->
<div class="modal" id="subscribe-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Subscription</h3>
            <button class="modal-close" id="close-subscribe-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="subscribe-form">
                <input type="hidden" id="subscribe-channel-id">
                
                <div class="form-group">
                    <label for="subscription-type">Type</label>
                    <select id="subscription-type" name="subscription_type" required>
                        <option value="channel">Channel</option>
                        <option value="playlist">Playlist</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="quality-preference">Quality Preference</label>
                    <select id="quality-preference" name="quality_preference">
                        <option value="best">Best Available</option>
                        <option value="1080p">1080p</option>
                        <option value="720p">720p</option>
                        <option value="480p">480p</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="check-frequency">Check Frequency</label>
                    <select id="check-frequency" name="check_frequency">
                        <option value="0 * * * *">Every hour</option>
                        <option value="0 */6 * * *">Every 6 hours</option>
                        <option value="0 */12 * * *">Every 12 hours</option>
                        <option value="0 0 * * *">Daily</option>
                        <option value="0 0 */3 * *">Every 3 days</option>
                        <option value="0 0 0 * *">Weekly</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="download-comments" name="download_comments">
                        Download comments
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-subscribe">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Subscription</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.channel-controls {
    display: flex;
    gap: var(--space-4);
    align-items: center;
    flex-wrap: wrap;
}

.search-group {
    display: flex;
    gap: var(--space-2);
    flex: 1;
    min-width: 300px;
}

.search-input {
    flex: 1;
    padding: var(--space-2) var(--space-3);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text);
    font-size: 0.875rem;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: var(--glow-primary);
}

.filter-group {
    display: flex;
    gap: var(--space-2);
    align-items: center;
}

.filter-select {
    padding: var(--space-2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text);
    font-size: 0.875rem;
    min-width: 140px;
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary);
}

.channels-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--space-4);
    margin-bottom: var(--space-6);
}

.channel-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: all 0.2s ease;
    cursor: pointer;
}

.channel-card:hover {
    border-color: var(--primary);
    box-shadow: var(--glow-primary);
    transform: translateY(-2px);
}

.channel-header {
    padding: var(--space-4);
    border-bottom: 1px solid var(--border);
}

.channel-info {
    display: flex;
    gap: var(--space-3);
    align-items: flex-start;
}

.channel-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--surface-hover);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--text-secondary);
    flex-shrink: 0;
}

.channel-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}

.channel-details {
    flex: 1;
    min-width: 0;
}

.channel-name {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--space-1);
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.channel-meta {
    font-size: 0.75rem;
    color: var(--text-secondary);
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.channel-stats {
    padding: var(--space-3) var(--space-4);
    background: var(--surface-hover);
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--space-3);
    text-align: center;
}

.stat-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.stat-value {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary);
}

.stat-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-weight: 500;
}

.channel-actions {
    padding: var(--space-3) var(--space-4);
    border-top: 1px solid var(--border);
    display: flex;
    gap: var(--space-2);
    justify-content: flex-end;
}

.subscription-badge {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
}

.subscription-badge.active {
    background: rgba(0, 255, 136, 0.2);
    color: var(--terminal-green);
    border: 1px solid rgba(0, 255, 136, 0.3);
}

.subscription-badge.paused {
    background: rgba(255, 170, 0, 0.2);
    color: var(--terminal-amber);
    border: 1px solid rgba(255, 170, 0, 0.3);
}

.pagination-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) 0;
    border-top: 1px solid var(--border);
}

.pagination-controls {
    display: flex;
    gap: var(--space-2);
    align-items: center;
}

.page-numbers {
    display: flex;
    gap: var(--space-1);
    margin: 0 var(--space-2);
}

.page-number {
    padding: var(--space-1) var(--space-2);
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text);
    text-decoration: none;
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

.page-number:hover {
    border-color: var(--primary);
    background: var(--surface-hover);
}

.page-number.active {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.channel-detail-grid {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: var(--space-6);
}

.channel-detail-main {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.channel-detail-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.detail-section {
    background: var(--surface-hover);
    padding: var(--space-3);
    border-radius: var(--radius);
    border: 1px solid var(--border);
}

.detail-section h4 {
    margin-bottom: var(--space-2);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--primary);
}

.detail-meta {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--space-2) var(--space-3);
    font-size: 0.875rem;
}

.detail-meta .label {
    font-weight: 500;
    color: var(--text-secondary);
}

.detail-actions {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
}

.recent-videos {
    max-height: 300px;
    overflow-y: auto;
}

.video-item {
    display: flex;
    gap: var(--space-2);
    padding: var(--space-2);
    border-bottom: 1px solid var(--border);
    transition: background 0.2s ease;
}

.video-item:hover {
    background: var(--surface);
}

.video-item:last-child {
    border-bottom: none;
}

.video-thumbnail-small {
    width: 60px;
    height: 34px;
    background: var(--surface);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    flex-shrink: 0;
}

.video-info-small {
    flex: 1;
    min-width: 0;
}

.video-title-small {
    font-size: 0.75rem;
    font-weight: 500;
    line-height: 1.3;
    margin-bottom: var(--space-1);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.video-meta-small {
    font-size: 0.625rem;
    color: var(--text-secondary);
}

@media (max-width: 768px) {
    .channel-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-group {
        min-width: unset;
    }
    
    .channels-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
    
    .channel-stats {
        grid-template-columns: 1fr 1fr;
        gap: var(--space-2);
    }
    
    .pagination-wrapper {
        flex-direction: column;
        gap: var(--space-3);
    }
    
    .channel-detail-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
class ChannelsPage {
    constructor() {
        this.currentPage = 1;
        this.perPage = 12;
        this.currentFilters = {
            search: '',
            subscription_status: ''
        };
        
        this.init();
    }
    
    async init() {
        this.setupEventListeners();
        await this.loadChannels();
    }
    
    setupEventListeners() {
        // Search
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        
        searchBtn.addEventListener('click', () => this.handleSearch());
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.handleSearch();
        });
        
        // Filters
        document.getElementById('subscription-filter').addEventListener('change', (e) => {
            this.currentFilters.subscription_status = e.target.value;
            this.resetAndSearch();
        });
        
        document.getElementById('clear-filters').addEventListener('click', () => {
            this.clearFilters();
        });
        
        // Pagination
        document.getElementById('prev-page').addEventListener('click', () => {
            if (this.currentPage > 1) {
                this.currentPage--;
                this.loadChannels();
            }
        });
        
        document.getElementById('next-page').addEventListener('click', () => {
            this.currentPage++;
            this.loadChannels();
        });
        
        // Modals
        document.getElementById('close-channel-detail').addEventListener('click', () => {
            youHoard.hideModal('channel-detail-modal');
        });
        
        document.getElementById('close-subscribe-modal').addEventListener('click', () => {
            youHoard.hideModal('subscribe-modal');
        });
        
        document.getElementById('cancel-subscribe').addEventListener('click', () => {
            youHoard.hideModal('subscribe-modal');
        });
        
        document.getElementById('subscribe-form').addEventListener('submit', (e) => {
            this.handleSubscribe(e);
        });
    }
    
    async loadChannels() {
        try {
            const params = new URLSearchParams({
                page: this.currentPage,
                per_page: this.perPage
            });
            
            // Add filters
            if (this.currentFilters.search) {
                params.append('search', this.currentFilters.search);
            }
            
            const response = await youHoard.apiCall(`/api/channels?${params}`);
            this.renderChannels(response.channels || []);
            this.renderPagination(response);
            
        } catch (error) {
            console.error('Failed to load channels:', error);
            this.renderError('Failed to load channels');
        }
    }
    
    renderChannels(channels) {
        const grid = document.getElementById('channels-grid');
        
        if (channels.length === 0) {
            grid.innerHTML = `
                <div class="loading-placeholder" style="grid-column: 1 / -1;">
                    No channels found. Try adjusting your filters or <a href="#" onclick="youHoard.showModal('add-video-modal')">add some videos</a> to create channels!
                </div>
            `;
            return;
        }
        
        grid.innerHTML = channels.map(channel => `
            <div class="channel-card" onclick="channelsPage.showChannelDetail(${channel.id})" style="position: relative;">
                ${channel.subscription_status ? `
                    <div class="subscription-badge ${channel.subscription_status}">
                        ${channel.subscription_status}
                    </div>
                ` : ''}
                
                <div class="channel-header">
                    <div class="channel-info">
                        <div class="channel-avatar">
                            ${channel.thumbnail_url ? 
                                `<img src="${channel.thumbnail_url}" alt="${youHoard.escapeHtml(channel.name)}" onerror="this.style.display='none'">` :
                                'ðŸ“º'
                            }
                        </div>
                        <div class="channel-details">
                            <div class="channel-name">${youHoard.escapeHtml(channel.name)}</div>
                            <div class="channel-meta">
                                <span>YouTube ID: ${channel.youtube_id}</span>
                                ${channel.subscriber_count ? `<span>${this.formatNumber(channel.subscriber_count)} subscribers</span>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="channel-stats">
                    <div class="stat-item">
                        <div class="stat-value">${channel.video_count || 0}</div>
                        <div class="stat-label">Videos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${channel.downloaded_count || 0}</div>
                        <div class="stat-label">Downloaded</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${channel.subscription_status ? 'âœ“' : 'â—‹'}</div>
                        <div class="stat-label">Subscribed</div>
                    </div>
                </div>
                
                <div class="channel-actions">
                    ${!channel.subscription_status ? 
                        `<button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); channelsPage.showSubscribeModal(${channel.id}, '${youHoard.escapeHtml(channel.name)}')">Subscribe</button>` :
                        `<button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); channelsPage.viewSubscription(${channel.id})">Manage</button>`
                    }
                    <a href="https://www.youtube.com/channel/${channel.youtube_id}" target="_blank" class="btn btn-secondary btn-sm" onclick="event.stopPropagation()">YouTube</a>
                </div>
            </div>
        `).join('');
    }
    
    renderPagination(response) {
        const wrapper = document.getElementById('pagination-wrapper');
        const info = document.getElementById('pagination-info-text');
        const prevBtn = document.getElementById('prev-page');
        const nextBtn = document.getElementById('next-page');
        const pageNumbers = document.getElementById('page-numbers');
        
        if (!response.total || response.total === 0) {
            wrapper.style.display = 'none';
            return;
        }
        
        wrapper.style.display = 'flex';
        
        // Update info
        const start = ((this.currentPage - 1) * this.perPage) + 1;
        const end = Math.min(this.currentPage * this.perPage, response.total);
        info.textContent = `Showing ${start}-${end} of ${response.total} channels`;
        
        // Update buttons
        prevBtn.disabled = this.currentPage === 1;
        const totalPages = Math.ceil(response.total / this.perPage);
        nextBtn.disabled = this.currentPage >= totalPages;
        
        // Update page numbers
        pageNumbers.innerHTML = this.generatePageNumbers(this.currentPage, totalPages);
    }
    
    generatePageNumbers(current, total) {
        const pages = [];
        const showPages = 5;
        let start = Math.max(1, current - Math.floor(showPages / 2));
        let end = Math.min(total, start + showPages - 1);
        
        if (end - start < showPages - 1) {
            start = Math.max(1, end - showPages + 1);
        }
        
        for (let i = start; i <= end; i++) {
            pages.push(`
                <a href="#" class="page-number ${i === current ? 'active' : ''}" 
                   onclick="channelsPage.goToPage(${i}); return false;">
                    ${i}
                </a>
            `);
        }
        
        return pages.join('');
    }
    
    goToPage(page) {
        this.currentPage = page;
        this.loadChannels();
    }
    
    handleSearch() {
        const searchInput = document.getElementById('search-input');
        this.currentFilters.search = searchInput.value.trim();
        this.resetAndSearch();
    }
    
    resetAndSearch() {
        this.currentPage = 1;
        this.loadChannels();
    }
    
    clearFilters() {
        document.getElementById('search-input').value = '';
        document.getElementById('subscription-filter').value = '';
        
        this.currentFilters = {
            search: '',
            subscription_status: ''
        };
        
        this.resetAndSearch();
    }
    
    async showChannelDetail(channelId) {
        try {
            const channel = await youHoard.apiCall(`/api/channels/${channelId}`);
            this.renderChannelDetail(channel);
            youHoard.showModal('channel-detail-modal');
        } catch (error) {
            console.error('Failed to load channel details:', error);
            youHoard.showToast('Failed to load channel details', 'error');
        }
    }
    
    renderChannelDetail(channel) {
        const content = document.getElementById('channel-detail-content');
        const title = document.getElementById('channel-detail-title');
        
        title.textContent = channel.name;
        
        content.innerHTML = `
            <div class="channel-detail-grid">
                <div class="channel-detail-main">
                    <div class="detail-section">
                        <h4>Description</h4>
                        <p>${channel.description ? youHoard.escapeHtml(channel.description).substring(0, 500) + (channel.description.length > 500 ? '...' : '') : 'No description available'}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h4>Recent Videos</h4>
                        <div class="recent-videos" id="recent-videos-${channel.id}">
                            <div class="loading-placeholder">Loading videos...</div>
                        </div>
                    </div>
                </div>
                
                <div class="channel-detail-sidebar">
                    <div class="detail-section">
                        <h4>Channel Information</h4>
                        <div class="detail-meta">
                            <span class="label">Name:</span>
                            <span>${youHoard.escapeHtml(channel.name)}</span>
                            
                            <span class="label">YouTube ID:</span>
                            <span style="font-family: var(--font-mono); font-size: 0.75rem;">${channel.youtube_id}</span>
                            
                            <span class="label">Subscribers:</span>
                            <span>${channel.subscriber_count ? this.formatNumber(channel.subscriber_count) : 'Unknown'}</span>
                            
                            <span class="label">Total Videos:</span>
                            <span>${channel.total_videos || 0}</span>
                            
                            <span class="label">Downloaded:</span>
                            <span>${channel.downloaded_videos || 0}</span>
                            
                            <span class="label">Storage Used:</span>
                            <span>${channel.total_size ? this.formatFileSize(channel.total_size) : '0 B'}</span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>Actions</h4>
                        <div class="detail-actions">
                            <a href="/videos?channel_id=${channel.id}" class="btn btn-primary btn-sm">View Videos</a>
                            <a href="https://www.youtube.com/channel/${channel.youtube_id}" target="_blank" class="btn btn-secondary btn-sm">YouTube</a>
                            <button class="btn btn-danger btn-sm" onclick="channelsPage.deleteChannel(${channel.id})">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Load recent videos
        this.loadChannelVideos(channel.id);
    }
    
    async loadChannelVideos(channelId) {
        try {
            const response = await youHoard.apiCall(`/api/channels/${channelId}/videos?per_page=5`);
            const container = document.getElementById(`recent-videos-${channelId}`);
            
            if (response.videos && response.videos.length > 0) {
                container.innerHTML = response.videos.map(video => `
                    <div class="video-item">
                        <div class="video-thumbnail-small">ðŸŽ¬</div>
                        <div class="video-info-small">
                            <div class="video-title-small">${youHoard.escapeHtml(video.title)}</div>
                            <div class="video-meta-small">
                                ${video.duration ? this.formatDuration(video.duration) : 'Unknown'} â€¢ 
                                ${video.download_status}
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="loading-placeholder">No videos found</div>';
            }
        } catch (error) {
            const container = document.getElementById(`recent-videos-${channelId}`);
            container.innerHTML = '<div class="loading-placeholder">Failed to load videos</div>';
        }
    }
    
    showSubscribeModal(channelId, channelName) {
        document.getElementById('subscribe-channel-id').value = channelId;
        youHoard.showModal('subscribe-modal');
    }
    
    async handleSubscribe(event) {
        event.preventDefault();
        
        const form = event.target;
        const formData = new FormData(form);
        const channelId = document.getElementById('subscribe-channel-id').value;
        
        try {
            const channel = await youHoard.apiCall(`/api/channels/${channelId}`);
            
            const subscriptionData = {
                source_url: `https://www.youtube.com/channel/${channel.youtube_id}`,
                subscription_type: formData.get('subscription_type'),
                quality_preference: formData.get('quality_preference'),
                check_frequency: formData.get('check_frequency'),
                download_comments: formData.get('download_comments') === 'on',
                enabled: true
            };
            
            await youHoard.apiCall('/api/subscriptions', {
                method: 'POST',
                body: JSON.stringify(subscriptionData)
            });
            
            youHoard.showToast('Subscription created successfully!', 'success');
            youHoard.hideModal('subscribe-modal');
            this.loadChannels(); // Refresh the list
            
        } catch (error) {
            console.error('Failed to create subscription:', error);
            youHoard.showToast('Failed to create subscription', 'error');
        }
    }
    
    async viewSubscription(channelId) {
        // Navigate to subscriptions page with this channel highlighted
        window.location.href = `/subscriptions?channel_id=${channelId}`;
    }
    
    async deleteChannel(channelId) {
        if (!confirm('Are you sure you want to delete this channel? This will also delete all associated videos and subscriptions.')) {
            return;
        }
        
        try {
            await youHoard.apiCall(`/api/channels/${channelId}`, { method: 'DELETE' });
            youHoard.showToast('Channel deleted successfully', 'success');
            youHoard.hideModal('channel-detail-modal');
            this.loadChannels(); // Refresh the list
        } catch (error) {
            console.error('Failed to delete channel:', error);
            youHoard.showToast('Failed to delete channel', 'error');
        }
    }
    
    renderError(message) {
        const grid = document.getElementById('channels-grid');
        grid.innerHTML = `
            <div class="loading-placeholder" style="grid-column: 1 / -1; color: var(--error);">
                ${message}
            </div>
        `;
    }
    
    formatNumber(num) {
        if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'K';
        }
        return num.toString();
    }
    
    formatFileSize(bytes) {
        const units = ['B', 'KB', 'MB', 'GB'];
        let size = bytes;
        let unitIndex = 0;
        
        while (size >= 1024 && unitIndex < units.length - 1) {
            size /= 1024;
            unitIndex++;
        }
        
        return `${size.toFixed(1)} ${units[unitIndex]}`;
    }
    
    formatDuration(seconds) {
        if (!seconds) return 'Unknown';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        if (hours > 0) {
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        } else {
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
    }
}

// Initialize when page loads
let channelsPage;
document.addEventListener('DOMContentLoaded', () => {
    channelsPage = new ChannelsPage();
});
</script>
{% endblock %} 